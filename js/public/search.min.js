$(document).ready(function(){FoWDB.search={page:1,cardsCounter:parseInt($("#cards-counter").html()),isInteger:function(a){return Number(parseInt(a))===parseInt(a)&&parseInt(a)%1==0?parseInt(a):0},fitCards:function(a){var t="cards-container",e=$("#"+t).length?$("#"+t):$("."+t),r=parseInt(e.width()),o=$("#opt_i_numxrow");if(a)var s=Math.floor(r/200);else(s=this.isInteger(o.val()))<1&&(s=1),10<s&&(s=10);o.val(s),$(".fdb-card").removeClass("fdb-card-1 fdb-card-2 fdb-card-3 fdb-card-4 fdb-card-5 fdb-card-6 fdb-card-7 fdb-card-8 fdb-card-9 fdb-card-10 ").addClass("fdb-card-"+s)}},$("#setcode-multiple").on("click",function(){var a=$("#setcode");a.attr("multiple")?(a.removeAttr("multiple").removeAttr("size"),a.attr("name","set")):(a.attr("multiple","true").attr("size",10),a.attr("name","set[]"))}),$(".seldrop_atk-operator").each(function(){$(this).on("click",function(){var a=$(this).data("words"),t=$(this).data("symbol");$(".dropdown-face","#atk-group").html(t),$("#atk-operator").val(a)})}),$(".seldrop_def-operator").each(function(){$(this).on("click",function(){var a=$(this).data("words"),t=$(this).data("symbol");$(".dropdown-face","#def-group").html(t),$("#def-operator").val(a)})}),$(".seldrop_sort").each(function(){$(this).on("click",function(){var a=$(this).data("field"),t=$(this).data("field-name");$(".dropdown-face","#sort-group").html(t),$("#sort").val(a)})}),$("#sortdir_handle").on("click",function(){$(this).hasClass("active")?($(this).removeClass("active"),$("#sortdir").val("asc")):($(this).addClass("active"),$("#sortdir").val("desc"))}),$("#form_search").on("submit",function(){$("#q").val()||$("#q").prop("disabled",!0),""==$("#atk").val()&&($("#atk").prop("disabled",!0),$("#atk-operator").prop("disabled",!0)),""==$("#def").val()&&($("#def").prop("disabled",!0),$("#def-operator").prop("disabled",!0));var a=$("#setcode :selected"),t=a.first();$("#setcode").attr("multiple")?1==a.length&&"0"==t.val()&&t.prop("disabled",!0):"0"==t.val()&&t.prop("disabled",!0),$("input[name='race']").val()||$("input[name='race']").prop("disabled",!0),$("input[name='artist']").val()||$("input[name='artist']").prop("disabled",!0),"default"==$("#sort").val()&&$("#sort").prop("disabled",!0),"asc"==$("#sortdir").val()&&$("#sortdir").prop("disabled",!0)}),$(".form-reset").on("click",function(){$("label.btn","#form_search").removeClass("active"),$("input","#form_search label.btn").removeAttr("checked"),$("input[name='format']").each(function(){"wandr"==$(this).val()&&($(this).closest("label").addClass("active"),$(this).prop("checked",!0))}),$("input[name='exact']").first().prop("checked",!0),$("input[name='exact']").first().closest("label").addClass("active"),$("#setcode").attr("multiple")&&($("#setcode").removeAttr("multiple").removeAttr("size"),$("#setcode").attr("name","set")),$("#setcode :selected").removeAttr("selected"),$('input[type="text"]',"#form_search").val(""),$("input#atk-operator").val("equals"),$(".dropdown-face","#atk-group").html("="),$("input#def-operator").val("equals"),$(".dropdown-face","#def-group").html("="),$("input#sort").val("sets_id"),$(".dropdown-face","#sort-group").html("Select a field..."),$("input#sortdir").val("asc"),$("#sortdir_handle").removeClass("active")}),$("#opt_b_numxrow_minus").on("click",function(){var a=parseInt($("#opt_i_numxrow").val())-1;0<a?$("#opt_i_numxrow").val(a):$("#opt_i_numxrow").val(1),FoWDB.search.fitCards()}),$("#opt_b_numxrow_plus").on("click",function(){var a=$("#opt_i_numxrow").val();$("#opt_i_numxrow").val(parseInt(a)+1),FoWDB.search.fitCards()}),$("#opt_i_numxrow").keyup(function(a){13==a.keyCode&&FoWDB.search.fitCards()}),$("#backside-clear").on("click",function(){$("label",$(this).parents(".filter")).each(function(){$(this).removeClass("active"),$("input",$(this)).attr("checked",!1)})}),$("#loadCards").on("submit",function(a){a.preventDefault();var l=$(this);FoWDB.search.page++;var t=window.location.search.replace("?","")+"&page="+FoWDB.search.page;$.ajax({url:"/api/cards",method:"GET",data:t,dataType:"json",cache:!1,error:function(a,t,e){console.log("ERROR!"),console.log("jqxhr",a),console.log("textStatus",t),console.log("errorThrown",e)},success:function(a,t){for(var e="fdb-card fdb-card-"+$("#opt_i_numxrow").val(),r=[],o=0,s=a.cardsData.length;o<s;o++){var n=a.cardsData[o],d=n.is_spoiler?" fdb-card-spoiled":"",i=window.BASE_URL+"/card/"+n.code;r.push(['<div class="',e,d,'">','<a href="',i,'" target="_self">','<img src="',n.thumb_path,'" alt="',n.name,'">',"</a>","</div>"].join(""))}var c=r.join("");$(c).insertBefore(".fdb-card-load").hide().show("fast"),FoWDB.search.cardsCounter+=a.cardsData.length,$("#cards-counter").html(FoWDB.search.cardsCounter),a.nextPage||l.remove()}})}),$(".js-panel-toggle").on("click",function(){$(this).toggleClass("active btn-default"),$(this).hasClass("js-panel-toggle-options")&&768<window.innerWidth&&($("#hide-options").toggleClass("col-sm-3"),$("#search-results").toggleClass("col-sm-9"))}),0<$("#search-results").length&&FoWDB.search.fitCards(!0),$(document).on({ajaxStart:function(){$(".fdb-loading-icon .fa").addClass("fa-spin")},ajaxStop:function(){$(".fdb-loading-icon .fa").removeClass("fa-spin")}}),$("input[name=page]").length&&(FoWDB.search.page=parseInt($("input[name=page]").val()))});